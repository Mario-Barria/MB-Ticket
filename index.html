
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escaneo de Entradas - MB Ticket</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { margin: 5px; padding: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        pre { background-color: #eee; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Escaneo de Entradas - MB Ticket</h1>
    <button onclick="simularEscaneo()">Simular escaneo</button>
    <button onclick="registrarManual()">Registrar manual</button>
    <button onclick="borrarRegistros()">Borrar registros</button>

    <h2>Registros de Hoy</h2>
    <table id="tabla-registros">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>DNI</th>
                <th>Hora</th>
            </tr>
        </thead>
        <tbody id="tbody-registros">
            <tr><td colspan="3">No hay registros aÃºn.</td></tr>
        </tbody>
    </table>

    <h3>ðŸ“¦ Vista rÃ¡pida de localStorage.registros</h3>
    <pre id="vista-localstorage"></pre>

    <script>
        let registros = JSON.parse(localStorage.getItem("registros") || "[]");

        function guardarRegistros() {
            localStorage.setItem("registros", JSON.stringify(registros));
        }

        function actualizarRegistros() {
            console.log("ðŸŸ¢ Ejecutando actualizarRegistros()");
            const hoy = new Date().toLocaleDateString();
            const registrosHoy = registros.filter(r =>
                new Date(r.fecha).toLocaleDateString() === hoy
            );
            console.log("ðŸ“¦ Registros actuales:", registrosHoy);

            const tbody = document.getElementById("tbody-registros");
            tbody.innerHTML = "";

            if (registrosHoy.length === 0) {
                const fila = tbody.insertRow();
                const celda = fila.insertCell();
                celda.colSpan = 3;
                celda.innerText = "No hay registros aÃºn.";
            } else {
                registrosHoy.forEach(r => {
                    const fila = tbody.insertRow();
                    fila.insertCell().innerText = r.nombre;
                    fila.insertCell().innerText = r.dni;
                    fila.insertCell().innerText = new Date(r.fecha).toLocaleTimeString();
                });
            }

            // Vista rÃ¡pida
            document.getElementById("vista-localstorage").innerText = JSON.stringify(registros, null, 4);
        }

        function simularEscaneo() {
            const nuevo = {
                dni: "99999999",
                nombre: "Test Usuario",
                fecha: new Date().toString(),
                tipo: "debug"
            };
            registros.push(nuevo);
            guardarRegistros();
            actualizarRegistros();
        }

        function registrarManual() {
            const nuevo = {
                dni: "12345678",
                nombre: "Registro Manual",
                fecha: new Date().toString(),
                tipo: "manual"
            };
            registros.push(nuevo);
            guardarRegistros();
            actualizarRegistros();
        }

        function borrarRegistros() {
            if (confirm("Â¿Seguro que querÃ©s borrar todos los registros?")) {
                registros = [];
                guardarRegistros();
                actualizarRegistros();
            }
        }

        // Inicial
        actualizarRegistros();
    </script>
</body>
</html>
